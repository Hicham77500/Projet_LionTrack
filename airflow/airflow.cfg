# fichier: airflow/airflow.cfg
# Configuration complète Apache Airflow pour LionTrack
# Documentation: https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html

[core]
# Répertoire contenant les DAGs
dags_folder = /opt/airflow/dags

# Répertoire des logs
base_log_folder = /opt/airflow/logs

# Répertoire des plugins
plugins_folder = /opt/airflow/plugins

# Exécuteur (LocalExecutor pour développement, CeleryExecutor pour prod)
executor = LocalExecutor

# Base de données SQLAlchemy
sql_alchemy_conn = postgresql+psycopg2://airflow:airflow@postgres:5432/airflow

# Clé de chiffrement Fernet
fernet_key = 

# Load d'exemples
load_examples = False

# Nombre maximal de workers
max_active_tasks_per_dag = 16

# Timeout des DAGs (en secondes)
dagbag_import_timeout = 30

# Email pour les alertes
default_mail_from = airflow@liontrack.com

# Encodage de la base de données
database_engine_encoding = utf-8

# Base de données par défaut
sql_engine_encoding = utf-8

[database]
# Configuration de la base de données
sql_alchemy_conn = postgresql+psycopg2://airflow:airflow@postgres:5432/airflow
sql_alchemy_pool_size = 5
sql_alchemy_pool_recycle = 3600

[webserver]
# Port du webserver
web_server_port = 8080

# Host du webserver
web_server_host = 0.0.0.0

# URL de base
base_log_folder = /opt/airflow/logs

# RBAC activé
rbac = True

# Mode lecture seule
expose_config = False

# Workers
workers = 1

# Threads
threads = 2

# Timeout des requêtes (secondes)
web_server_worker_timeout = 120

# Garder les logs de combien de jours
log_retention_days = 30

[scheduler]
# Interval de vérification des DAGs (secondes)
dag_dir_list_interval = 300

# Nombre maximum de DAG runs parallèles par DAG
max_dagruns_to_create_per_loop = 10

# Nombre maximum de tâches parallèles
max_active_runs_per_dag = 1

# Interval de heartbeat du scheduler
heartbeat_interval = 5

[email]
# Configuration SMTP
email_backend = airflow.providers.email.backends.smtp.SendEmailBackend

[smtp]
# Serveur SMTP
smtp_host = smtp.gmail.com
smtp_port = 587
smtp_user = your-email@gmail.com
smtp_password = your-app-password
smtp_mail_from = airflow@liontrack.com
smtp_starttls = True

[logging]
# Format des logs
log_format = [%%(asctime)s] {%%(filename)s:%%(lineno)d} %%(levelname)s - %%(message)s
simple_log_format = %%(asctime)s %%(levelname)s - %%(message)s

[api]
# API REST activée
enable_experimental_api = True

[operators]
# Dossier par défaut pour les scripts bash
default_queue = default

[celery]
# Broker pour Celery (si vous utilisez CeleryExecutor)
broker_url = redis://redis:6379/0
result_backend = db+postgresql://airflow:airflow@postgres:5432/airflow

[kubernetes]
# Configuration Kubernetes (si vous utilisez KubernetesExecutor)
namespace = airflow
